{"paragraphs":[{"text":"import org.apache.spark.sql.types._\n\n// Datasets from \n// https://ourworldindata.org/what-does-the-world-die-from\n// https://stats.oecd.org/Index.aspx?DataSetCode=EDU_DEM\n// https://data.worldbank.org/indicator/sp.dyn.cdrt.in\n// https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv\n\nval populationsDF = spark.read.format(\"csv\")\n  .option(\"sep\", \",\")\n  .option(\"inferSchema\", \"true\")\n  .option(\"header\", \"true\")\n  .load(\"/home/julex/PDD/death_causes/populations.csv\")\n  \n\nval deathCausesSchema = StructType(Array(\n  StructField(\"Entity\", StringType, nullable = false),\n  StructField(\"Code\", StringType, nullable = false),\n  StructField(\"Year\", IntegerType, nullable = false),\n  StructField(\"Cardiovascular_diseases\", DoubleType, nullable = true),\n  StructField(\"Cancers\", DoubleType, nullable = true),\n  StructField(\"Respiratory_diseases\", DoubleType, nullable = true)))\n  \nval deathCausesDF = spark.read.format(\"csv\")\n  .option(\"sep\", \",\")\n  .schema(deathCausesSchema)\n  .option(\"header\", \"true\")\n  .load(\"/home/julex/PDD/death_causes/share-of-deaths-by-cause.csv\")\n  \n  \n// Removed first 4 lines from csv file with not important information\nval deathRateDF = spark.read.format(\"csv\")\n  .option(\"sep\", \",\")\n  .option(\"inferSchema\", \"true\")\n  .option(\"header\", \"true\")\n  .load(\"/home/julex/PDD/death_causes/API_SP.DYN.CDRT.IN_DS2_en_csv_v2_888876.csv\")\n  .withColumnRenamed(\"Country Name\", \"CountryName\")\n  .withColumnRenamed(\"Country Code\", \"CountryCode\")\n  .withColumnRenamed(\"Indicator Code\", \"IndicatorCode\")\n  .withColumnRenamed(\"2017\", \"DeathRate\")\n  \n\nval covidDF = spark.read.format(\"csv\")\n  .option(\"sep\", \",\")\n  .option(\"inferSchema\", \"true\")\n  .option(\"header\", \"true\")\n  .load(\"/home/julex/PDD/death_causes/time_series_covid19_deaths_global.csv\")\n  .withColumnRenamed(\"Province/State\", \"Province\")\n  .withColumnRenamed(\"Country/Region\", \"Country\")\n  .withColumnRenamed(\"4/4/20\", \"4April\")\n  .withColumnRenamed(\"4/5/20\", \"5April\")\n","user":"anonymous","dateUpdated":"2020-04-06T22:22:58+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\npopulationsDF: org.apache.spark.sql.DataFrame = [COUNTRY0: string, Country1: string ... 15 more fields]\ndeathCausesSchema: org.apache.spark.sql.types.StructType = StructType(StructField(Entity,StringType,false), StructField(Code,StringType,false), StructField(Year,IntegerType,false), StructField(Cardiovascular_diseases,DoubleType,true), StructField(Cancers,DoubleType,true), StructField(Respiratory_diseases,DoubleType,true))\ndeathCausesDF: org.apache.spark.sql.DataFrame = [Entity: string, Code: string ... 4 more fields]\ndeathRateDF: org.apache.spark.sql.DataFrame = [CountryName: string, CountryCode: string ... 63 more fields]\ncovidDF: org.apache.spark.sql.DataFrame = [Province: string, Country: string ... 77 more fields]\n"}]},"apps":[],"jobName":"paragraph_1586156440727_-161361537","id":"20191226-205728_654766197","dateCreated":"2020-04-06T09:00:40+0200","dateStarted":"2020-04-06T22:20:50+0200","dateFinished":"2020-04-06T22:20:52+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:105470"},{"text":"populationsDF.createOrReplaceTempView(\"populations\")\ndeathCausesDF.createOrReplaceTempView(\"death_causes\")\ndeathRateDF.createOrReplaceTempView(\"death_rate\")\ncovidDF.createOrReplaceTempView(\"covid\")","user":"anonymous","dateUpdated":"2020-04-06T22:20:52+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1586156440752_1339697985","id":"20191226-221949_1989088816","dateCreated":"2020-04-06T09:00:40+0200","dateStarted":"2020-04-06T22:20:52+0200","dateFinished":"2020-04-06T22:20:52+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105471"},{"text":"%sql\n\n/* How many people died per day in each country (divided into deaths caused by cardiovascular diseases, cancer, respiratory diseases) compared to deaths by COVID-19 from 04.04.2020 to 05.04.2020 */\n\nSELECT dr.CountryName,\nFLOOR(dr.DeathRate * pop.Value / 1000 * dc.Cardiovascular_diseases / 100 / 365) AS Cardiovascular_diseases_deaths_per_day, \nFLOOR(dr.DeathRate * pop.Value / 1000 * dc.Cancers / 100 / 365) AS Cancer_deaths_per_day, \nFLOOR(dr.DeathRate * pop.Value / 1000 * dc.Respiratory_diseases / 100 / 365) AS Respiratory_diseases_deaths_per_day,\ncv.Deaths_per_day AS COVID_19_deaths_per_day\nFROM death_rate AS dr\nINNER JOIN (SELECT COUNTRY0, Country1, Value from populations WHERE SEX2 == \"T\" and YEAR6 == 2017 and AGE4 == \"T\") AS pop ON pop.COUNTRY0=dr.CountryCode\nINNER JOIN (SELECT * from death_causes WHERE Year = \"2017\") AS dc ON dc.Code=dr.CountryCode\n/* Unfortunately, one of the most important rows (USA) had different name in each datasets */\nINNER JOIN (SELECT Country, SUM(5April) - SUM(4April) AS Deaths_per_day FROM covid GROUP BY Country) AS cv ON (cv.Country=dr.CountryName OR (cv.Country=\"US\" AND dr.CountryName=\"United States\")) \nWHERE dr.IndicatorCode = \"SP.DYN.CDRT.IN\" \nORDER BY cv.Deaths_per_day DESC","user":"anonymous","dateUpdated":"2020-04-06T22:20:52+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"CountryName":"string","Cardiovascular_diseases_deaths_per_day":"string","Cancer_deaths_per_day":"string","Respiratory_diseases_deaths_per_day":"string","COVID_19_deaths_per_day":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"scatterChart":{"xAxis":{"name":"CountryName","index":0,"aggr":"sum"},"yAxis":{"name":"COVID_19_possible_deaths_in_2020","index":5,"aggr":"sum"}}},"keys":[{"name":"CountryName","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"COVID_19_possible_deaths_in_2020","index":5,"aggr":"sum"}],"commonSetting":{}},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"CountryName\tCardiovascular_diseases_deaths_per_day\tCancer_deaths_per_day\tRespiratory_diseases_deaths_per_day\tCOVID_19_deaths_per_day\nUnited States\t2382\t1847\t520\t1212\nSpain\t340\t318\t92\t694\nUnited Kingdom\t481\t490\t129\t623\nItaly\t618\t515\t82\t525\nFrance\t442\t518\t59\t519\nBelgium\t88\t84\t18\t164\nGermany\t961\t681\t125\t140\nNetherlands\t109\t140\t27\t115\nTurkey\t429\t271\t89\t73\nSwitzerland\t60\t50\t7\t49\nCanada\t216\t231\t43\t41\nBrazil\t1040\t656\t194\t41\nPortugal\t97\t77\t17\t29\nSweden\t92\t65\t12\t28\nIreland\t25\t25\t5\t21\nMexico\t452\t271\t95\t19\nAustria\t88\t61\t9\t18\nDenmark\t34\t41\t10\t18\nPoland\t471\t305\t33\t15\nNorway\t34\t31\t7\t9\nChile\t81\t82\t16\t7\nSlovenia\t20\t16\t1\t6\nGreece\t144\t88\t17\t5\nIsrael\t31\t34\t4\t5\nAustralia\t133\t128\t27\t5\nLuxembourg\t3\t3\t0\t5\nColombia\t215\t147\t48\t3\nFinland\t57\t35\t4\t3\nHungary\t169\t95\t16\t2\nLithuania\t60\t21\t2\t2\nEstonia\t21\t9\t0\t2\nCosta Rica\t19\t16\t3\t0\nIceland\t2\t1\t0\t0\nJapan\t1007\t1135\t147\t0\nLatvia\t43\t15\t1\t0\nNew Zealand\t30\t27\t5\t0\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1586195854232_-1576591908","id":"20200406-195734_1351135668","dateCreated":"2020-04-06T19:57:34+0200","dateStarted":"2020-04-06T22:20:52+0200","dateFinished":"2020-04-06T22:20:53+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105472"},{"text":"%sql\n\n/* How many people is possibly going to die due to COVID-19 in 2020 */\n\nSELECT \nSUM(cv.Deaths_per_day) * 365 AS COVID_19_world_deaths_in_2020\nFROM (SELECT Country, SUM(5April) - SUM(4April) AS Deaths_per_day FROM covid GROUP BY Country) AS cv\n","user":"anonymous","dateUpdated":"2020-04-06T22:20:53+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"COVID_19_world_deaths_in_2020":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"COVID_19_world_deaths_in_2020\n1740320\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1586202928099_1177969770","id":"20200406-215528_1466152559","dateCreated":"2020-04-06T21:55:28+0200","dateStarted":"2020-04-06T22:20:54+0200","dateFinished":"2020-04-06T22:20:55+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105473"}],"name":"JulianProlejko_PDD_DeathCauses","id":"2F6V62SVS","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}